<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>食色-菜谱编辑</title>
  <!-- 引入Element-UI样式 -->
  <link rel="stylesheet" href="/dist/element-ui/lib/theme-chalk/index.css">
  <link rel="stylesheet" href="/common/css/common.css">
  <!-- <link rel="stylesheet" href="../dist/bootstrap-3.3.7/dist/css/bootstrap.min.css"> -->
  <link rel="stylesheet" href="/common/css/hearder-nav.css">
  <link rel="stylesheet" href="/common/css/edit.css">
  <style>
      .el-tag + .el-tag {
        margin-left: 10px;
      }
      .button-new-tag {
        margin-left: 10px;
        height: 32px;
        line-height: 30px;
        padding-top: 0;
        padding-bottom: 0;
      }
      .input-new-tag {
        width: 90px;
        margin-left: 10px;
        vertical-align: bottom;
      }
    .m-10 {
      margin: 10px;
    }

    </style>
</head>

<body>
  <div id="app" v-cloak>
    <el-container>
      <el-header class="header">
        <header id="header" class="header bg-white animated headroom--top headroom--not-bottom">
          <div class="navbar-container">
            <a href="/indexPage" class="navbar-logo">
              <img src="/images/jiandan.png" alt="煎蛋">
            </a>
            <el-autocomplete class="inline-input" v-model="searchInfo.query" :fetch-suggestions="autocompleteAsync" placeholder="请输入内容" :trigger-on-focus="false"
                             @select="searchResultsSelect">
              <i slot="prefix" class="el-input__icon el-icon-search"></i>
              <el-button slot="append" @click="search">搜索</el-button>
            </el-autocomplete>
            <div class="navbar-menu">
              <a href="/listPage?type=recipe">创意菜谱</a>
              <a href="/listPage?type=subject">主题菜单</a>
              <a href="/listPage?type=foodnote">食记</a>
              <a href="/recipeEditPage" v-if="userInfo.isLogin !== false">
                <!-- 写作按钮 -->
                <el-tooltip content="创建菜谱吧！" placement="bottom" effect="light">
                  <img class="writer-icon" src="data:image/svg+xml;base64,CjxzdmcgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDEwMDAgMTAwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwMCAxMDAwIiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPG1ldGFkYXRhPiDnn6Lph4/lm77moIfkuIvovb0gOiBodHRwOi8vd3d3LnNmb250LmNuLyA8L21ldGFkYXRhPjxnPjxwYXRoIGQ9Ik00OTkuOSwxMEMyMjkuNCwxMCwxMCwyMjkuNCwxMCw1MDBjMCwyNzAuNywyMTkuNCw0OTAsNDg5LjksNDkwQzc3MC42LDk5MCw5OTAsNzcwLjYsOTkwLDUwMEM5OTAsMjI5LjQsNzcwLjYsMTAsNDk5LjksMTB6IE00OTkuOSw5NTVDMjQ4LjYsOTU1LDQ1LDc1MS4zLDQ1LDUwMGMwLTI1MS4zLDIwMy43LTQ1NSw0NTUtNDU1Qzc1MS4zLDQ1LDk1NSwyNDguNyw5NTUsNTAwQzk1NSw3NTEuMyw3NTEuMyw5NTUsNDk5LjksOTU1eiIgc3R5bGU9ImZpbGw6IzU2YWJlNCI+PC9wYXRoPjxwYXRoIGQ9Ik03NDUsMjU2bC0xLjItMS4yYy01OC41LTU4LjMtMTUzLjUtNTguNC0yMTEuOC0wLjNMMjEyLjMsNTczLjFsMi42LDEuNmMtMi45LDIuNS0zLjksNi4xLTMuOSwxMC4zdjE5MS4zYzAsNy41LDQsMTIuNywxMS42LDEyLjdoMTkyYzQuMiwwLDcuOC0xLjUsMTAuMy00LjRsMC43LDAuOUw3NDUuMyw0NjdDODAzLjYsNDA4LjksODAzLjQsMzE0LjMsNzQ1LDI1NnogTTI2NC4zLDczNC41Yy03LjMtNy4zLTEyLjEtOS4zLTI1LjgtNy4zVjYwOC45bDY3LjksMi40bDEuNyw2NS4xbC0wLjgsMTQuOWwwLjksMGwtMC4xLDFMMzIzLDY5Mmw2NS41LDEuOGwyLjQsNjcuOUgyNzAuOEMyNzMuMiw3NDgsMjcxLjgsNzQyLDI2NC4zLDczNC41eiBNNjA4LjcsNDQ4LjdMMzg5LjcsNjY2LjlsLTU1LjEtMS45bC0yLTU3LjJsMjE3LjgtMjE3LjFMNjA4LjcsNDQ4Ljd6IE00MjUuMyw3NDcuM2MtMC4zLDAuNC0wLjUsMC45LTAuOSwxLjNjLTIuMSwyLjEtNC4yLDQuMS02LjMsNi4xbC0yLjUtNzIuMmwwLjEtMi44TDYyOCw0NjguMWwzOC44LDM4LjZMNDI1LjYsNzQ3LjF2MEM0MjUuNSw3NDcuMiw0MjUuNCw3NDcuMiw0MjUuMyw3NDcuM3ogTTUxMS43LDMxMy40bDE5LjQtMTkuM2wxNzQuNSwxNzRsLTE5LjQsMTkuM0w1MTEuNywzMTMuNHogTTI1MC41LDU3My41YzAuMy0wLjQsMC43LTAuNSwxLjEtMC44bDI0MC43LTI0MGwzOC44LDM4LjVMMzE3LjQsNTg0aC0wLjJsLTc0LjgtMi40QzI0NS4xLDU3OC45LDI0Ny44LDU3Ni40LDI1MC41LDU3My41eiBNNzI1LjksNDQ3LjhsLTAuOSwwLjlsLTE3NC41LTE3NGwwLjktMC45YzQ3LjYtNDcuNSwxMjUuMy00Ny40LDE3MywwLjJsMS4yLDEuMkM3NzMuNSwzMjIuOSw3NzMuNSw0MDAuMyw3MjUuOSw0NDcuOHoiIHN0eWxlPSJmaWxsOiM1NmFiZTQiPjwvcGF0aD48L2c+PC9zdmc+ICA=">
                </el-tooltip>
              </a>
              <a href="/foodnoteEditPage" v-if="userInfo.isLogin !== false">
                <!-- 写作按钮 -->
                <el-tooltip content="创建食记吧！" placement="bottom" effect="light">
                  <img class="writer-icon" src="data:image/png;base64,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">
                </el-tooltip>
              </a>
            </div>
            <div class="navbar-user">
              <a href="/loginPage" v-if="userInfo.isLogin === false">
                <span class="el-dropdown-link">
                  <el-tooltip content="未登录哦！" placement="bottom" effect="light">
                    <img class="user-hearder" src="/images/login_avatar.png" alt="">
                  </el-tooltip>
                </span>
              </a>
              <a :href=" user_href + userInfo.id " v-else>
                <el-dropdown @command="dropdownComand">
                  <span class="el-dropdown-link">
                    <img class="user-hearder" :src="userInfo.avatar" :alt="userInfo.avatar">
                  </span>
                  <el-dropdown-menu slot="dropdown">
                    <el-dropdown-item icon="el-icon-menu" command=" /userPage">个人中心</el-dropdown-item>
                    <el-dropdown-item icon="el-icon-document" command="/listPage">菜谱集</el-dropdown-item>
                    <el-dropdown-item icon="el-icon-document" command="/listPage">菜单集</el-dropdown-item>
                    <el-dropdown-item icon="el-icon-star-off" command="">收藏的文章</el-dropdown-item>
                    <el-dropdown-item divided icon="el-icon-close" command="signOut">退出</el-dropdown-item>
                  </el-dropdown-menu>
                </el-dropdown>
              </a>
            </div>
          </div>
        </header>
      </el-header>
      <el-main class="content-wapper">
        <!-- 菜谱编辑区 -->
        <section class="recipe-edit">
          <!-- <el-row> -->
            <el-col :offset="4" :span="16" :sm="24" :md="16">

                <el-input class="recipe-title" placeholder="输入标题" v-model="recipeInfo.title" clearable>
                </el-input>
              <!-- 封面上传 -->
              <el-upload class="avatar-uploader" action="/api/file/upload" :show-file-list="false"
                         :on-success="handleCoverSuccess" :before-upload="beforeAvatarUpload" style="display: block;">
                <img v-if="recipeInfo.cover" :src="recipeInfo.cover" class="avatar" style="width: 600px; height: 400px;">
                <i v-else class="el-icon-plus avatar-uploader-icon"></i>
              </el-upload>
              <!-- 登录者信息 -->
              <div class="author">
                  <a :href="user_href + userInfo.id" :title="userInfo.username + '的厨房' " class="avatar-link avatar" tabindex="-1" target="_blank">
                      <img :src="userInfo.avatar" :alt="userInfo.username + '的厨房' " width="60" height="60">
                      <span>&nbsp;{{ userInfo.username }}</span>
                  </a>
              </div>
              <div class="recipe-describe" type="textarea">
                <textarea placeholder="添加菜谱描述～～" v-model="recipeInfo.synopsis" ></textarea>
              </div>
              <!-- 材料  -->
              <h2 class="title">标签</h2>
              <div class="">
                  <el-tag :key="tag.id" v-for="(tag, index) in tagsInfo.list" closable :disable-transitions="false" @close="tagRemove(index)">
                    {{tag.name}}
                  </el-tag>
                  <el-input class="input-new-tag" v-if="tagsInfo.inputVisible" v-model="tagsInfo.inputValue" ref="saveTagInput" size="small" @keyup.enter.native="addTag"
                    @blur="addTag"/>
                  <el-button v-else class="button-new-tag" size="small" @click="showInput">+ New </el-button>
              </div>
              <!--用料-->
              <h2 class="title">用料</h2>
              <div class="">
                <el-table
                        :data="materialsList"
                        style="width: 93%" :show-header="false">
                  <el-table-column width="180">
                  <template slot-scope="scope">
                    <el-input v-model="scope.row.name" placeholder="食材名"></el-input>
                  </template>
                </el-table-column>
                  <el-table-column width="180">
                    <template slot-scope="scope">
                      <el-input v-model="scope.row.amount" placeholder="用量"></el-input>
                    </template>
                  </el-table-column>
                  </el-table-column>
                  <el-table-column width="180">
                    <template slot-scope="scope">
                      <el-input v-model="scope.row.unit" placeholder="单位：克/g,千克/kg"></el-input>
                    </template>
                  </el-table-column>
                  <el-table-column >
                    <template slot-scope="scope">
                      <el-button size="mini" round type="text" @click="removeMaterial(scope.$index)" icon="el-icon-delete"></el-button>
                    </template>
                  </el-table-column>
                </el-table>
                <el-button class="m-10" size="mini" round  @click="addMaterial" >添加材料</el-button>
              </div>
              <!-- 步骤编写 -->
              <h2 class="title">做法</h2>
              <div class="steps-wapper">
                <ol>
                  <li v-for="(item, index) in processList" :key="item.index" @click="processIndexChange(index)">
                    <textarea class="" name="" id="" cols="30" rows="10" v-model="item.content">
                    </textarea>
                    <el-upload class="process-uploader" action="/api/file/upload" :show-file-list="false"
                               :on-success="uploadProcessPicture" :before-upload="beforeAvatarUpload"
                               style="display: inlink-block;" >
                      <img v-if="item.picture" :src="item.picture" class="avatar" style="width: 200px; height: 200px;">
                      <i v-else class="el-icon-plus process-uploader-icon"></i>
                    </el-upload>
                  </li>
                  <!--  步骤 -->
                </ol>
                <el-button size="mini" round  @click="addProcess" >添加步骤</el-button>
              </div>
              <div class="tip-container" style="width: 600px;">
                  <h2>小贴士</h2>
                  <div class="tip">
                    <div class="placeholder" type="textarea">
                      <textarea placeholder="添加贴士吧........." class="input text" style="overflow: hidden; word-wrap: break-word; height: 70px;" v-model="recipeInfo.content"></textarea>
                    </div>
                  </div>
              </div>
              <div class="btn-box">
                <el-button id="release-recipe" round @click="releaseRecipe">发布</el-button>
                <el-button id="save-recipe" round @click="saveRecipe">保存</el-button>
                <el-button id="" round >取消</el-button>
              </div>
            </el-col>
            <!--<el-col :span="8" :sm="8" :md="8" >-->
              <!--<section class="rigth-box">-->
                <!--&lt;!&ndash; 主题选择 &ndash;&gt;-->
                <!--<h2 class="title">选择主题</h2>-->
                <!--<div class="choose-subject">-->
                    <!--<el-table @current-change="" :data="subject" style="width: 100%">-->
                      <!--<el-table-column type="expand">-->
                        <!--<template slot-scope="props">-->
                          <!--<el-form label-position="left" inline class="demo-table-expand">-->
                            <!--<el-form-item label="类别">-->
                              <!--<span>{{ props.row.category }}</span>-->
                            <!--</el-form-item>-->
                            <!--<el-form-item label="简介">-->
                              <!--<span>{{ props.row.desc }}</span>-->
                            <!--</el-form-item>-->
                          <!--</el-form>-->
                        <!--</template>-->
                      <!--</el-table-column>-->
                      <!--<el-table-column label="主题菜单" prop="name">-->
                      <!--</el-table-column>-->
                      <!--<el-table-column label="选择" prop="id">-->
                        <!--<template slot-scope="scope">-->
                          <!--&lt;!&ndash; <el-button size="mini" @click="">选择</el-button> &ndash;&gt;-->
                          <!--<el-radio border @change="" v-model="radio" :label="scope.row.id">{{scope.row.id}}</el-radio>-->
                        <!--</template>-->
                      <!--</el-table-column>-->
                    <!--</el-table>-->
                <!--</div>-->
              <!--</section>-->
            <!--</el-col>-->
          <!-- </el-row> -->
        </section>
        </el-main>
      <el-footer class="footer-warpper">
        <div class="footer-container">Copyright © 2017 liezh.com All Rights Reserved | 京ICP备 13046642号-2</div>
      </el-footer>

    </el-container>
  </div>

</body>
<!-- 先引入 Vue -->
<script src="/dist/vue.js"></script>
<!-- 引入Element-UI组件库 -->
<script src="/dist/element-ui/lib/index.js"></script>
<script src="/dist/axios.min.js"></script>
<!-- 工具方法文件 -->
<script src="/common/js/main.js"></script>
<script>
  const IMG_PATH = "/images/";
  new Vue({
    el: '#app',
    data: function () {
      return {
          article_href : '/recipePage?r id=',
          subject_href : '/subjectPage?sid=',
          user_href: '/userPage?uid=',
          recipeInfo: {
              title: '',
              cover: '',
              content: '',
              synopsis: '',
              process: '',
              materials: ''

          },
          processIndex: 0,
          processList: [
              {
                  content: '',
                  picture: '',
                  index: 1
              },
              {
                  content: '',
                  picture: '',
                  index: 2
              },
              {
                  content: '',
                  picture: '',
                  index: 3
              }
          ],
          materialsList: [
              {
                  name: '',
                  unit: '',
                  amount: ''
              },

          ],

          userInfo: {
              id : '',
              username : '',
              name : '',
              avatar : '',
              isLogin: false
          },
          searchInfo: {
              query: ''
          },


        // 标签
          tagsInfo: {
              inputVisible: false,
              inputValue: '',
              list: [
              ]
          },

        radio: '',
        subject: [{
          id: 1,
          name: '甜点',
          category: '江浙小吃、小吃零食',
          desc: '荷兰优质淡奶，奶香浓而不腻',
        }, {
          id: 2,
          name: '家常菜',
          category: '江浙小吃、小吃零食',
          desc: '荷兰优质淡奶，奶香浓而不腻',
        }, {
          id: 3,
          name: '蔬菜',
          category: '江浙小吃、小吃零食',
          desc: '荷兰优质淡奶，奶香浓而不腻',
        }]
      }
    },
    methods: {
        dropdownComand(command) {
            let self = this;
            if(command == 'signOut') {
                // 清除用户信息
                Util.authTokenRemove();
                Util.userInfoRemove();
                window.location.href  = '/loginPage';
                return ;
            }
            window.location.href = command + "?uid=" + this.userInfo.id;
        },
        // 异步搜索提示
        autocompleteAsync(queryString, cb) {
            if (queryString !== '') {
                axios.get('/api/autocomplete?query=' + queryString).then((response) => {
                    let res = response.data;
                if(res.code == 1000) {
                    let results = res.data;
                    cb(results);
                } else {
                    console.log(`code : ${res.code}, msg : ${res.msg}`);
                }

            }).catch((err) => {
                    console.log(err);
            });
            }
        },
        // 搜索框的选择事件
        searchResultsSelect(queryString) {
            console.log(queryString);
        },
        search() {
            self.location = '/searchPage?query=' + this.searchInfo.query;
        },



      // 封面上传
      handleCoverSuccess(res, file) {
            if (res.code == 1000) {
//                this.recipeInfo.cover = URL.createObjectURL(res.data.url);
                this.recipeInfo.cover = res.data.url;
            } else {
                this.$notify.warning({
                    dangerouslyUseHTMLString: true,
                    title: '封面上传失败',
                    message: `上传失败! <br/> CODE：${res.code}  MSG：${res.msg}`
                });
            }

      },
        uploadProcessPicture(res, file, fileList) {
            if (res.code == 1000) {
//                this.recipeInfo.cover = URL.createObjectURL(res.data.url);

                this.processList[this.processIndex].picture = res.data.url;
            } else {
                this.$notify.warning({
                    dangerouslyUseHTMLString: true,
                    title: '上传失败',
                    message: `上传失败! <br/> CODE：${res.code}  MSG：${res.msg}`
                });
            }
        },
        processIndexChange(index) {
            this.processIndex = index;
        },
      beforeAvatarUpload(file) {
        const isJPG = file.type === 'image/jpeg' || file.type === 'image/jpg' || file.type === 'image/png';
        const isLt2M = file.size / 1024 / 1024 < 2;

        if (!isJPG) {
          this.$message.error('上传头像图片只能是 JPG 格式!');
        }
        if (!isLt2M) {
          this.$message.error('上传头像图片大小不能超过 2MB!');
        }
        return isJPG && isLt2M;
      },
      // tag
       tagRemove(index) {
          this.tagsInfo.list.splice(index, 1);
      },

      showInput() {
        this.tagsInfo.inputVisible = true;
        this.$nextTick(_ => {
          this.$refs.saveTagInput.$refs.input.focus();
        });
      },
      
      addTag() {
        let inputValue = this.tagsInfo.inputValue;
        if (inputValue) {
            let tag = {name: inputValue};
            axios.post('/api/t', tag, {
                headers: {
                    'Authorization': Util.authTokenGetter()
                }
            }).then((response) => {
                let res = response.data;
            if(res.code == 1000) {
                tag.id = res.data;
                this.tagsInfo.list.push(tag);
            } else {
                console.log(`code : ${res.code}, msg : ${res.msg}`);
            }

          }).catch((err) => {
                console.log(err);
          });
        }
        this.tagsInfo.inputVisible = false;
        this.tagsInfo.inputValue = '';
      },

        insertRecipeTagBatch(rid) {
            if (rid === null || rid === undefined || rid === "") {
              return;
            }
            axios.post(`/api/t/${rid}`, self.tagsInfo.list, {
                headers: {
                    'Authorization': Util.authTokenGetter()
                }
            }).then((response) => {
                let res = response.data;
            if(res.code == 1000) {
                console.log(`code：${res.code}, msg：${res.msg}`);
            } else {
                console.log(`code : ${res.code}, msg : ${res.msg}`);
            }

        }).catch((err) => {
                console.log(err);
        });
        },


        addProcess() {
          let self = this;
          let process = {
              content: '',
              picture: '',
              index: self.processList.length + 1
          }
          self.processList.push(process);
        },
        addMaterial() {
            let self = this;
            let material = {
                name: '',
                unit: '',
                amount: ''
            }
            self.materialsList.push(material);
        },
        removeMaterial(index) {
            let self = this;
            self.materialsList.splice(index, 1);
        },

        // 发布并保存
        releaseRecipe() {
            let self = this;
            self.recipeInfo.materials = self.materialsList;
            self.recipeInfo.process = self.processList;
            axios.post(`/api/r/release`, self.recipeInfo, {
                headers: {
                    'Authorization': Util.authTokenGetter()
                }
            }).then((response) => {
                let res = response.data;
            if(res.code == 1000) {
                self.recipeInfo.id = res.data;
                // 保存映射
                insertRecipeTagBatch(res.data);
                this.$notify.success({
                    dangerouslyUseHTMLString: true,
                    title: '发布成功',
                    message: `成功发布-${self.recipeInfo.title}-`
                });
            } else {
                console.log(`code : ${res.code}, msg : ${res.msg}`);
            }

        }).catch((err) => {
                console.log(err);
        });

        },
        saveRecipe() {
            let self = this;
            if (self.recipeInfo.id) {
                self.updateRecipeInfo();
                return ;
            }
            self.insertRecipeInfo();
        },
        insertRecipeInfo() {
            let self = this;
            // 如果存在id，调用update
            if (self.recipeInfo.id) {
                self.updateRecipeInfo();
                return ;
            }
            let materials = JSON.stringify(self.materialsList);
            let process =  JSON.stringify(self.processList);
            self.recipeInfo.materials = self.materialsList;
            self.recipeInfo.process = self.processList;
            console.log(`data: ${self.recipeInfo}`);
            // 发送请求
            axios.post('/api/r', self.recipeInfo, {
                headers: {
                    'Authorization': Util.authTokenGetter()
                }
            }).then((response) => {
                let res = response.data;
            if(res.code == 1000) {
                self.recipeInfo.id = res.data;
                // 添加recipe_tag映射
                self.insertRecipeTagBatch(res.data);
                this.$notify.success({
                    dangerouslyUseHTMLString: true,
                    title: '保存成功',
                    message: `成功保存-${self.recipeInfo.title}-`
                });
            } else {
                console.log(`code : ${res.code}, msg : ${res.msg}`);
            }

        }).catch((err) => {
                console.log(err);
        });
        },
        updateRecipeInfo() {
            let self = this;
            // 如果不存在id，调用insert
            if (!self.recipeInfo.id) {
                self.insertRecipeInfo();
                return ;
            }
            self.recipeInfo.materials = self.materialsList;
            self.recipeInfo.process = self.processList;
            console.log(`data: ${self.recipeInfo}`);
            // 发送请求
            axios.put('/api/r', self.recipeInfo, {
                headers: {
                    'Authorization': Util.authTokenGetter()
                }
            }).then((response) => {
                let res = response.data;
            if(res.code == 1000) {
                // 添加recipe_tag映射
                self.insertRecipeTagBatch(self.recipeInfo.id);
                this.$notify.success({
                    dangerouslyUseHTMLString: true,
                    title: '保存成功',
                    message: `成功保存-${self.recipeInfo.title}-`
                });
            } else {
                console.log(`code : ${res.code}, msg : ${res.msg}`);
            }

        }).catch((err) => {
                console.log(err);
        });
        },
        getRecipeInfo() {
            let request = Util.getRequest();
            console.log("req " + request['rid']);
//        this.getRecipeInfo(request['id']);
            axios.get('/api/r/' + request['rid'], {
                headers: {
                    'Authorization': Util.authTokenGetter()
                }
            }).then((response) => {
                let res = response.data;
            if (res.code == 1000) {
                this.recipeInfo = res.data;
                this.processList = JSON.parse(res.data.process);
                this.materialsList = JSON.parse(res.data.materials);
                this.tagsInfo.list = res.data.tags;
                console.log(`data  ${this.recipeInfo}`);
            } else {
                alert(`code : ${res.code}, msg : ${res.msg}`);
            }
        }).catch((err) => {
                console.log(err);
        });
        }

    },

    created: function() {
          // 获取菜谱信息
          this.getRecipeInfo();
      },
    mounted() {
        let self = this;
        //  vue 开始挂载渲染时获取
        this.userInfo = Util.loginUserInfoGetter();
        let a = 1;
    }
  });
</script>

</html>